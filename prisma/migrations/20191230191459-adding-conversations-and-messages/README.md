# Migration `20191230191459-adding-conversations-and-messages`

This migration has been generated by Balin Sinnott at 12/30/2019, 7:14:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "main"."User" (
  "birthday" text  NOT NULL DEFAULT '' ,
  "email" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Conversation" (
  "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text  NOT NULL  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."Message" (
  "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text  NOT NULL  ,
  "message" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "main"."_ConversationToUser" (
  "A" text  NOT NULL  REFERENCES "main"."Conversation"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "main"."User"("id") ON DELETE CASCADE
);

ALTER TABLE "main"."Message" ADD COLUMN "author" text  NOT NULL  REFERENCES "main"."User"("id") ON DELETE RESTRICT,
ADD COLUMN "conversation" text    REFERENCES "main"."Conversation"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.email" ON "main"."User"("email")

CREATE UNIQUE INDEX "_ConversationToUser_AB_unique" ON "main"."_ConversationToUser"("A","B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20191230191459-adding-conversations-and-messages
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,40 @@
+generator photon {
+  provider = "photonjs"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRES_URL")
+}
+
+// datasource db {
+//   provider = "mysql"
+//   url      = env("MYSQL_URL")
+// }
+
+// datasource db {
+//   provider = "sqlite"
+//   url      = "file:dev.db"
+// }
+
+model User {
+ id     String  @default(cuid()) @id
+ email  String  @unique
+ name   String
+ birthday String
+ conversations Conversation[]
+}
+
+model Conversation {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  messages  Message[]
+  participants User[]
+}
+
+model Message {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  message String
+  author User
+}
```


